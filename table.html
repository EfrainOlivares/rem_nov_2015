<!DOCTYPE html>
<html>
<head>
    <title>Simple tables in D3</title>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
    <script src="https://rawgit.com/gka/d3-jetpack/master/d3-jetpack.js"></script>
    <script src="rsreports.js"></script>
    <style type="text/css">
    body { font-family: 'Helvetica Neue', Helvetica; font-weight: 300; padding: 20px;}
    th { text-align: left; }
    th, td { padding: 0 1em 0.5ex 0;}
    th.center, td.center { text-align: center; }
    th.num, td.num { text-align: right; }
    </style>
</head>
<body>
  <table></table>
<script>
      d3.json("http://rem2015.efrain.biz:8080/api/json?pretty=true", function(error, json) {
          if (error) return console.warn(error);
          firstload(json);
      });
 
      function firstload(parsedjson) {
        all_jobs_list = parsedjson["jobs"];

        jobs_list = remove_destroyers(all_jobs_list);
     
        // column definitions
        var columns = [
            { head: 'JOB name', cl: 'title', html: ƒ('name') },
            { head: 'status', cl: 'center', html: ƒ('color') },
        ];
    
        // create table
        var table = d3.select('body').selectAll('table');
    
        // create table header
        table.selectAll('thead').selectAll('tr')
            .selectAll('th')
            .data(columns)
            .enter()
            .append('th')
            .attr('class', ƒ('cl'))
            .text(ƒ('head'));
    
        // create table body
        table.append('tbody')
            .selectAll('tr')
            .data(jobs_list).enter()
            .append('tr')
            .selectAll('td')
            .data(function(row, i) {
                return columns.map(function(c) {
                    // compute cell values for this specific row
                    var cell = {};
                    d3.keys(c).forEach(function(k) {
                        cell[k] = typeof c[k] == 'function' ? c[k](row,i) : c[k];
                    });
                    return cell;
                });
            }).enter()
            .append('td')
            .html(ƒ('html'))
            .attr('id', ƒ('html'))
            .attr('class', ƒ('cl'));
    }

    function render(parsedjson) {
        
        all_jobs_list = parsedjson["jobs"];

        jobs_list = remove_destroyers(all_jobs_list);
 
        console.log( html_color(jobs_list[0]["color"]) );
        for (i = 0; i < jobs_list.length; i++) {
          d3.select('#' + jobs_list[i]["name"])
            .style('color', html_color(jobs_list[i]["color"]));
        } 
    }

    function reload() {
      d3.json("http://rem2015.efrain.biz:8080/api/json?pretty=true", function(error, json) {
          if (error) return console.warn(error);
          render(json);
      });
    }
    setInterval(function () {
        reload();
    }, 15000);

    reload();

    </script>
</body>
</html>
