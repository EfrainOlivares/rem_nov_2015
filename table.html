<!DOCTYPE html>
<html>
<head>
    <title>Simple tables in D3</title>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
    <script src="https://rawgit.com/gka/d3-jetpack/master/d3-jetpack.js"></script>
    <style type="text/css">
    body { font-family: 'Helvetica Neue', Helvetica; font-weight: 300; padding: 20px;}
    th { text-align: left; }
    th, td { padding: 0 1em 0.5ex 0;}
    th.center, td.center { text-align: center; }
    th.num, td.num { text-align: right; }
    </style>
    <script>
      function loadjson()
      {
        return $.ajax({url: "http://rem2015.efrain.biz:8080/api/json?pretty=true", async: false}).responseText
      }
    </script> 
</head>
<body>
<script>
    function render() {
        parsedjson = JSON.parse(loadjson());
        
        jobs_list = parsedjson["jobs"];
        //console.log("Starting job length is: " + jobs_list.length);        
        // Kick out destroyer jobs
        movies = _.reject(jobs_list, function(i) {
          return i["name"].match(/^Z|000|^update_/);
        }); 
     
        // column definitions
        var columns = [
            { head: 'JOB name', cl: 'title', html: ƒ('name') },
            { head: 'status', cl: 'center', html: ƒ('color') },
        ];
    
        // create table
        var table = d3.select('body')
            .append('table');
    
        // create table header
        table.append('thead').append('tr')
            .selectAll('th')
            .data(columns).enter()
            .append('th')
            .attr('class', ƒ('cl'))
            .text(ƒ('head'));
    
        // create table body
        table.append('tbody')
            .selectAll('tr')
            .data(movies).enter()
            .append('tr')
            .selectAll('td')
            .data(function(row, i) {
                return columns.map(function(c) {
                    // compute cell values for this specific row
                    var cell = {};
                    d3.keys(c).forEach(function(k) {
                        cell[k] = typeof c[k] == 'function' ? c[k](row,i) : c[k];
                    });
                    return cell;
                });
            }).enter()
            .append('td')
            .html(ƒ('html'))
            .attr('class', ƒ('cl'));
    
        function length() {
            var fmt = d3.format('02d');
            return function(l) { return Math.floor(l / 60) + ':' + fmt(l % 60) + ''; };
        }
    
    } //end of render
    setInterval(function () {
        render();
    }, 2500);

    render();

    </script>
</body>
</html>
